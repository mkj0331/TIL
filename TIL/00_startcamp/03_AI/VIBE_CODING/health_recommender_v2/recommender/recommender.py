# 맞춤 운동 추천 알고리즘 모듈
from .user_input import UserInfo

def recommend_exercise(user: UserInfo) -> dict:
    """
    사용자 정보를 기반으로 맞춤 운동 종목과 루틴을 추천합니다.
    추천 결과는 dict로 반환합니다.
    """
    # 운동 목적별 맞춤 추천
    if user.goal:
        goal = user.goal.strip()
        if goal == "감량":
            return {
                "종목": "체중 감량 맞춤 루틴",
                "루틴": "유산소(러닝머신 30분, 싸이클 20분) + 전신 근력운동(맨몸 스쿼트 3세트, 푸쉬업 3세트, 플랭크 3세트)",
                "주의": "식단과 병행, 무리한 중량은 피하세요."
            }
        elif goal == "유지":
            return {
                "종목": "체중 유지 맞춤 루틴",
                "루틴": "근력운동(벤치프레스 3세트, 랫풀다운 3세트, 레그프레스 3세트) + 유산소(걷기 20분)",
                "주의": "운동 빈도와 강도를 꾸준히 유지하세요."
            }
        elif goal == "증량":
            return {
                "종목": "근육 증량 맞춤 루틴",
                "루틴": "중량 근력운동(스쿼트 4세트, 데드리프트 4세트, 벤치프레스 4세트, 바벨로우 4세트) + 보조운동(이두/삼두 각 3세트)",
                "주의": "충분한 휴식과 영양 섭취를 병행하세요."
            }
    # 운동 부위 세분화
    all_parts = ["가슴", "등", "어깨", "이두", "삼두", "하체", "유산소"]
    next_parts = [part for part in all_parts if part not in user.recent_parts]
    if user.condition == "피로" or user.condition == "통증":
        return {
            "종목": "스트레칭 및 가벼운 유산소",
            "루틴": "전신 스트레칭 10분, 가벼운 걷기 20분",
            "주의": "몸 상태가 좋지 않으니 무리한 운동은 피하세요."
        }
    if user.environment == "홈트":
        if next_parts:
            part = next_parts[0]
            if part == "가슴":
                return {
                    "종목": "가슴 근력 홈트",
                    "루틴": "푸쉬업 3세트, 딥스 3세트, 체스트플라이 3세트",
                    "주의": "맨몸 위주로 진행하세요."
                }
            elif part == "등":
                return {
                    "종목": "등 근력 홈트",
                    "루틴": "슈퍼맨 3세트, 풀업 3세트, 밴드로우 3세트",
                    "주의": "기구가 부족하니 밴드 활용 추천."
                }
            elif part == "어깨":
                return {
                    "종목": "어깨 근력 홈트",
                    "루틴": "숄더프레스 3세트, 레터럴레이즈 3세트, 플랭크 3세트",
                    "주의": "가벼운 동작부터 시작하세요."
                }
            elif part == "이두":
                return {
                    "종목": "이두 근력 홈트",
                    "루틴": "암컬 3세트, 밴드컬 3세트, 풀업 3세트",
                    "주의": "과도한 반복은 피하세요."
                }
            elif part == "삼두":
                return {
                    "종목": "삼두 근력 홈트",
                    "루틴": "딥스 3세트, 푸쉬업 3세트, 밴드익스텐션 3세트",
                    "주의": "팔꿈치 통증 주의."
                }
            elif part == "하체":
                return {
                    "종목": "하체 근력 홈트",
                    "루틴": "스쿼트 3세트, 런지 3세트, 브릿지 3세트",
                    "주의": "무릎 상태를 확인하며 진행하세요."
                }
            elif part == "유산소":
                return {
                    "종목": "유산소 홈트",
                    "루틴": "버피 3세트, 점핑잭 3세트, 마운틴클라이머 3세트",
                    "주의": "호흡을 잘 조절하세요."
                }
        else:
            return {
                "종목": "전신 홈트",
                "루틴": "스트레칭 2세트, 맨몸 근력운동 2세트, 유산소 혼합 2세트",
                "주의": "운동 부위가 모두 소진되어 전신 운동 추천."
            }
    if user.environment == "헬스장":
        if user.equipment == "충분":
            if next_parts:
                part = next_parts[0]
                if part == "가슴":
                    return {
                        "종목": "가슴 근력 운동",
                        "루틴": "벤치프레스 4세트, 체스트플라이 3세트, 딥스 3세트",
                        "주의": "중량은 무리하지 않게 조절하세요."
                    }
                elif part == "등":
                    return {
                        "종목": "등 근력 운동",
                        "루틴": "랫풀다운 4세트, 바벨로우 4세트, 풀업 3세트",
                        "주의": "허리 부상 주의."
                    }
                elif part == "어깨":
                    return {
                        "종목": "어깨 근력 운동",
                        "루틴": "숄더프레스 4세트, 레터럴레이즈 3세트, 업라이트로우 3세트",
                        "주의": "가벼운 중량부터 시작하세요."
                    }
                elif part == "이두":
                    return {
                        "종목": "이두 근력 운동",
                        "루틴": "바벨컬 3세트, 덤벨컬 3세트, 친업 3세트",
                        "주의": "팔꿈치 통증 주의."
                    }
                elif part == "삼두":
                    return {
                        "종목": "삼두 근력 운동",
                        "루틴": "푸쉬다운 3세트, 딥스 3세트, 오버헤드익스텐션 3세트",
                        "주의": "과도한 반복은 피하세요."
                    }
                elif part == "하체":
                    return {
                        "종목": "하체 근력 운동",
                        "루틴": "스쿼트 4세트, 레그프레스 3세트, 런지 3세트",
                        "주의": "무릎과 허리 상태를 체크하세요."
                    }
                elif part == "유산소":
                    return {
                        "종목": "유산소 운동",
                        "루틴": "러닝머신 30분, 싸이클 20분, 계단오르기 15분",
                        "주의": "운동 전 충분히 준비운동 하세요."
                    }
            else:
                return {
                    "종목": "전신 근력 및 유산소",
                    "루틴": "스트레칭 2세트, 근력운동 2세트, 유산소 혼합 2세트",
                    "주의": "운동 부위가 모두 소진되어 전신 운동 추천."
                }
        else:
            return {
                "종목": "맨몸 또는 소도구 운동",
                "루틴": "덤벨 3세트, 밴드 3세트, 맨몸 위주 근력운동 3세트",
                "주의": "기구가 부족하니 맨몸 위주로 진행하세요."
            }
    if user.smm and user.body_fat:
        if user.smm < 30:
            smm_comment = "골격근량이 낮으니 근력운동을 늘려보세요."
        else:
            smm_comment = "골격근량이 적정 수준입니다."
        if user.body_fat > 20:
            bf_comment = "체지방량이 높으니 유산소 운동을 병행하세요."
        else:
            bf_comment = "체지방량이 적정 수준입니다."
        return {
            "종목": "개인 맞춤 운동",
            "루틴": f"근력운동 + 유산소 혼합, {smm_comment} {bf_comment}",
            "주의": "신체 상태에 따라 운동 강도를 조절하세요."
        }
    return {
        "종목": "가벼운 전신 운동",
        "루틴": "스트레칭 2세트, 걷기 20분, 맨몸 근력운동 2세트",
        "주의": "운동 전후 충분히 준비운동과 마무리운동 하세요."
    }
